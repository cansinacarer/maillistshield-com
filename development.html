

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Development &mdash; Mail List Shield v1.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=d29a5c0e"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.2.0/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.2.0/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs";

const defaultStyle = document.createElement('style');
defaultStyle.textContent = `pre.mermaid {
    /* Same as .mermaid-container > pre */
    display: block;
    width: 100%;
}

pre.mermaid > svg {
    /* Same as .mermaid-container > pre > svg */
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}
`;
document.head.appendChild(defaultStyle);

const fullscreenStyle = document.createElement('style');
fullscreenStyle.textContent = `.mermaid-container {
    display: flex;
    flex-direction: row;
    width: 100%;
}

.mermaid-container > pre {
    display: block;
    width: 100%;
}

.mermaid-container > pre > svg {
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}

.mermaid-fullscreen-btn {
    width: 28px;
    height: 28px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    font-size: 14px;
    line-height: 1;
    padding: 0;
    color: #333;
}

.mermaid-fullscreen-btn:hover {
    opacity: 100% !important;
    background: rgba(255, 255, 255, 1);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    transform: scale(1.1);
}

.mermaid-fullscreen-btn.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #e0e0e0;
}

.mermaid-fullscreen-btn.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 3px 10px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal {
    display: none;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 95vw;
    height: 100vh;
    background: rgba(255, 255, 255, 0.98);
    z-index: 9999;
    padding: 20px;
    overflow: auto;
}

.mermaid-fullscreen-modal.dark-theme {
    background: rgba(0, 0, 0, 0.98);
}

.mermaid-fullscreen-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen {
    position: relative;
    width: 95vw;
    height: 90vh;
    max-width: 95vw;
    max-height: 90vh;
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    overflow: auto;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen.dark-theme {
    background: #1a1a1a;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
}

.mermaid-container-fullscreen pre.mermaid {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen .mermaid svg {
    height: 100% !important;
    width: 100% !important;
    cursor: grab;
}

.mermaid-fullscreen-close {
    position: fixed !important;
    top: 20px !important;
    right: 20px !important;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.2);
    border-radius: 50%;
    cursor: pointer;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: all 0.2s;
    font-size: 24px;
    line-height: 1;
    color: #333;
}

.mermaid-fullscreen-close:hover {
    background: white;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    transform: scale(1.1);
}

.mermaid-fullscreen-close.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #e0e0e0;
}

.mermaid-fullscreen-close.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 6px 16px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal .mermaid-fullscreen-btn {
    display: none !important;
}`;
document.head.appendChild(fullscreenStyle);

// Detect if page has dark background
const isDarkTheme = () => {
    const bgColor = window.getComputedStyle(document.body).backgroundColor;
    const match = bgColor.match(/rgb\((\d+),\s*(\d+),\s*(\d+)/);
    if (match) {
        const r = parseInt(match[1]);
        const g = parseInt(match[2]);
        const b = parseInt(match[3]);
        const brightness = (r * 299 + g * 587 + b * 114) / 1000;
        return brightness < 128;
    }
    return false;
};

const load = async () => {
    await mermaid.run();

    const all_mermaids = document.querySelectorAll(".mermaid");
    const mermaids_processed = document.querySelectorAll(".mermaid[data-processed='true']");

    if ("False" === "True") {
        const mermaids_to_add_zoom = -1 === -1 ? all_mermaids.length : -1;
        if(mermaids_to_add_zoom > 0) {
            var svgs = d3.selectAll("");
            if(all_mermaids.length !== mermaids_processed.length) {
                setTimeout(load, 200);
                return;
            } else if(svgs.size() !== mermaids_to_add_zoom) {
                setTimeout(load, 200);
                return;
            } else {
                svgs.each(function() {
                    var svg = d3.select(this);
                    svg.html("<g class='wrapper'>" + svg.html() + "</g>");
                    var inner = svg.select("g");
                    var zoom = d3.zoom().on("zoom", function(event) {
                        inner.attr("transform", event.transform);
                    });
                    svg.call(zoom);
                });
            }
        }
    } else if(all_mermaids.length !== mermaids_processed.length) {
        // Wait for mermaid to process all diagrams
        setTimeout(load, 200);
        return;
    }

    const darkTheme = isDarkTheme();

    // Stop here if not adding fullscreen capability
    if ("True" !== "True") return;

    const modal = document.createElement('div');
    modal.className = 'mermaid-fullscreen-modal' + (darkTheme ? ' dark-theme' : '');
    modal.setAttribute('role', 'dialog');
    modal.setAttribute('aria-modal', 'true');
    modal.setAttribute('aria-label', 'Fullscreen diagram viewer');
    modal.innerHTML = `
        <button class="mermaid-fullscreen-close${darkTheme ? ' dark-theme' : ''}" aria-label="Close fullscreen">‚úï</button>
        <div class="mermaid-container-fullscreen${darkTheme ? ' dark-theme' : ''}"></div>
    `;
    document.body.appendChild(modal);

    const modalContent = modal.querySelector('.mermaid-container-fullscreen');
    const closeBtn = modal.querySelector('.mermaid-fullscreen-close');

    let previousScrollOffset = [window.scrollX, window.scrollY];

    const closeModal = () => {
        modal.classList.remove('active');
        modalContent.innerHTML = '';
        document.body.style.overflow = ''
        window.scrollTo({left: previousScrollOffset[0], top: previousScrollOffset[1], behavior: 'instant'});
    };

    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            closeModal();
        }
    });

    const allButtons = [];

    document.querySelectorAll('.mermaid').forEach((mermaidDiv) => {
        if (mermaidDiv.parentNode.classList.contains('mermaid-container') ||
            mermaidDiv.closest('.mermaid-fullscreen-modal')) {
            return;
        }

        const container = document.createElement('div');
        container.className = 'mermaid-container';
        mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
        container.appendChild(mermaidDiv);

        const fullscreenBtn = document.createElement('button');
        fullscreenBtn.className = 'mermaid-fullscreen-btn' + (darkTheme ? ' dark-theme' : '');
        fullscreenBtn.setAttribute('aria-label', 'View diagram in fullscreen');
        fullscreenBtn.textContent = '‚õ∂';
        fullscreenBtn.style.opacity = '50%';

        // Calculate dynamic position based on diagram's margin and padding
        const diagramStyle = window.getComputedStyle(mermaidDiv);
        const marginTop = parseFloat(diagramStyle.marginTop) || 0;
        const marginRight = parseFloat(diagramStyle.marginRight) || 0;
        const paddingTop = parseFloat(diagramStyle.paddingTop) || 0;
        const paddingRight = parseFloat(diagramStyle.paddingRight) || 0;
        fullscreenBtn.style.top = `${marginTop + paddingTop + 4}px`;
        fullscreenBtn.style.right = `${marginRight + paddingRight + 4}px`;

        fullscreenBtn.addEventListener('click', () => {
            previousScrollOffset = [window.scroll, window.scrollY];
            const clone = mermaidDiv.cloneNode(true);
            modalContent.innerHTML = '';
            modalContent.appendChild(clone);

            const svg = clone.querySelector('svg');
            if (svg) {
                svg.removeAttribute('width');
                svg.removeAttribute('height');
                svg.style.width = '100%';
                svg.style.height = 'auto';
                svg.style.maxWidth = '100%';
                svg.style.sdisplay = 'block';

                if ("False" === "True") {
                    setTimeout(() => {
                        const g = svg.querySelector('g');
                        if (g) {
                            var svgD3 = d3.select(svg);
                            svgD3.html("<g class='wrapper'>" + svgD3.html() + "</g>");
                            var inner = svgD3.select("g");
                            var zoom = d3.zoom().on("zoom", function(event) {
                                inner.attr("transform", event.transform);
                            });
                            svgD3.call(zoom);
                        }
                    }, 100);
                }
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });

        container.appendChild(fullscreenBtn);
        allButtons.push(fullscreenBtn);
    });

    // Update theme classes when theme changes
    const updateTheme = () => {
        const dark = isDarkTheme();
        allButtons.forEach(btn => {
            if (dark) {
                btn.classList.add('dark-theme');
            } else {
                btn.classList.remove('dark-theme');
            }
        });
        if (dark) {
            modal.classList.add('dark-theme');
            modalContent.classList.add('dark-theme');
            closeBtn.classList.add('dark-theme');
        } else {
            modal.classList.remove('dark-theme');
            modalContent.classList.remove('dark-theme');
            closeBtn.classList.remove('dark-theme');
        }
    };

    // Watch for theme changes
    const observer = new MutationObserver(updateTheme);
    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class', 'style', 'data-theme']
    });
    observer.observe(document.body, {
        attributes: true,
        attributeFilter: ['class', 'style']
    });
};

window.addEventListener("load", load);
</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Continuous Integration and Continuous Deployment" href="ci-cd.html" />
    <link rel="prev" title="Features" href="features.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Mail List Shield
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="features.html#developer-experience">üßë‚Äçüíª Developer Experience</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#deployment">‚òÅÔ∏è Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#stripe-integrations">üí≥ Stripe Integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#authentication">üîí Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#transactional-emails-with-smtp">üìß Transactional Emails with SMTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#security">üö® Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#ui">üé® UI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="features.html#notifications">üîî Notifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="features.html#bootstrap-html-templates">üåê Bootstrap HTML templates</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#code-quality-conventional-commits-and-releases">Code Quality, Conventional Commits, and Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#developing-in-dev-containers">Developing in Dev Containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#local-endpoints-served-by-the-dev-containers">Local Endpoints Served by the Dev Containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging">Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-stripe-webhooks">Testing Stripe Webhooks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#database-model">Database Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#updating-the-database-model">Updating the Database Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-build-on-top-of-this-app">How to Build On Top of This App</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-new-pages">Adding New Pages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-more-configuration-variables">Defining More Configuration Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-dependencies">Updating Dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ci-cd.html">Continuous Integration and Continuous Deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ci-cd.html#pre-commit-hooks">Pre-Commit Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="ci-cd.html#run-tests">Run Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="ci-cd.html#semantic-release">Semantic Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="ci-cd.html#build-deploy">Build &amp; Deploy</a></li>
<li class="toctree-l2"><a class="reference internal" href="ci-cd.html#build-deploy-sphinx-docs">Build &amp; Deploy Sphinx Docs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment to Production</a><ul>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#a-pitfall-for-cloudflare-proxy">A Pitfall for Cloudflare Proxy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/index.html">Auto Generated Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="autoapi/app/index.html">app</a><ul>
<li class="toctree-l3"><a class="reference internal" href="autoapi/app/index.html#submodules">Submodules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/config/index.html">app.config</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/decorators/index.html">app.decorators</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/emails/index.html">app.emails</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/forms/index.html">app.forms</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/models/index.html">app.models</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/utilities/index.html">app.utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/views/index.html">app.views</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/views_api/index.html">app.views_api</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/views_auth/index.html">app.views_auth</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/views_private/index.html">app.views_private</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/app/index.html#attributes">Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/app/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/app/index.html#package-contents">Package Contents</a><ul>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/index.html#app.mail"><code class="docutils literal notranslate"><span class="pre">mail</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/index.html#app.db"><code class="docutils literal notranslate"><span class="pre">db</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/index.html#app.bc"><code class="docutils literal notranslate"><span class="pre">bc</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/index.html#app.lm"><code class="docutils literal notranslate"><span class="pre">lm</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/index.html#app.csrf"><code class="docutils literal notranslate"><span class="pre">csrf</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/app/index.html#app.create_app"><code class="docutils literal notranslate"><span class="pre">create_app()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact the Developer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Mail List Shield</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Development</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/development.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="development">
<h1>Development<a class="headerlink" href="#development" title="Link to this heading">ÔÉÅ</a></h1>
<section id="code-quality-conventional-commits-and-releases">
<h2>Code Quality, Conventional Commits, and Releases<a class="headerlink" href="#code-quality-conventional-commits-and-releases" title="Link to this heading">ÔÉÅ</a></h2>
<p>Code quality is maintained by <em>pre-commit</em> hooks and <code class="docutils literal notranslate"><span class="pre">.vscode/settings.json</span></code> locally; then also enforced with GitHub Actions in the remote repository.</p>
<ul class="simple">
<li><p>Python scripts are required to follow <code class="docutils literal notranslate"><span class="pre">black</span></code> code style.</p></li>
<li><p>HTML, CSS, and Javascript files are checked with <code class="docutils literal notranslate"><span class="pre">prettier</span></code>.</p></li>
<li><p>Markdown files are checked with <code class="docutils literal notranslate"><span class="pre">markdownlint</span></code>.</p></li>
</ul>
<p>Commit messages are required to follow the conventional commits standard. This is enforced by the <code class="docutils literal notranslate"><span class="pre">commitlint</span></code> pre-commit hook and the CI/CD pipeline.</p>
<p>The release process is automated with GitHub Actions. When a new tag is pushed, the CI/CD pipeline will automatically build and deploy the app to the production server based on the semantic release standards, and create a Changelog file with the changes since the last release.</p>
</section>
<section id="developing-in-dev-containers">
<h2>Developing in Dev Containers<a class="headerlink" href="#developing-in-dev-containers" title="Link to this heading">ÔÉÅ</a></h2>
<p>Dev Containers are a the recommended way to develop this project. You simply clone this repository and open it in VS Code. Make sure that the Docker daemon is running, then use <code class="docutils literal notranslate"><span class="pre">&gt;Dev</span> <span class="pre">Containers:</span> <span class="pre">Reopen</span> <span class="pre">in</span> <span class="pre">Container</span></code> command in VS Code. This will create containers with the following applications:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Flask</dt><dd><ul>
<li><p>Accessible at <code class="docutils literal notranslate"><span class="pre">https://localhost:5000</span></code>. It uses the self-signed SSL
certificate generated in <code class="docutils literal notranslate"><span class="pre">.devcontainer/ssl</span></code>. Never use these certificates for production!</p></li>
<li><p>This is where the app runs. It is based on the official Python image
with the packages from <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> installed.</p></li>
<li><p>It also has additional packages installed for development, such as
<code class="docutils literal notranslate"><span class="pre">black</span></code>, <code class="docutils literal notranslate"><span class="pre">pytest</span></code>, and <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>pgAdmin</dt><dd><ul>
<li><p>Accessible at <code class="docutils literal notranslate"><span class="pre">http://localhost:5002</span></code>. You can use this to manage the
Postgres database.</p></li>
<li><p>It is already configured to connect to the Postgres container. When prompted
for the database password, use <code class="docutils literal notranslate"><span class="pre">password</span></code>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Postgres</dt><dd><ul>
<li><p>When Flask is initialized, it will create the tables in this database.</p></li>
<li><p>If you need to access the database, it is available at <code class="docutils literal notranslate"><span class="pre">localhost:5432</span></code>.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<section id="local-endpoints-served-by-the-dev-containers">
<h3>Local Endpoints Served by the Dev Containers<a class="headerlink" href="#local-endpoints-served-by-the-dev-containers" title="Link to this heading">ÔÉÅ</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Port</p></th>
<th class="head"><p>Application</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://localhost:5000">https://localhost:5000</a></p></td>
<td><p>Flask application run with debug mode active</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://localhost:5001">https://localhost:5001</a></p></td>
<td><p>Flask application run with VSCode debugger</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="http://localhost:5002">http://localhost:5002</a></p></td>
<td><p>pgAdmin instance connected to the local development database</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="http://localhost:5003">http://localhost:5003</a></p></td>
<td><p>HTTP service serving the html files of the documentation in <code class="docutils literal notranslate"><span class="pre">docs/build/html</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Link to this heading">ÔÉÅ</a></h3>
<p>The configuration in <code class="docutils literal notranslate"><span class="pre">.vscode/launch.json</span></code> allows us to use the VSCode debugger to set breakpoints and inspect variables. The Flask instance run this way will be available at <code class="docutils literal notranslate"><span class="pre">http://localhost:5001</span></code>.</p>
</section>
<section id="testing-stripe-webhooks">
<h3>Testing Stripe Webhooks<a class="headerlink" href="#testing-stripe-webhooks" title="Link to this heading">ÔÉÅ</a></h3>
<p>For testing with Stripe, you‚Äôll need to get the webhook secret (<code class="docutils literal notranslate"><span class="pre">whsec_...</span></code>) using this Stripe CLI command:</p>
<p><code class="docutils literal notranslate"><span class="pre">stripe</span> <span class="pre">listen</span> <span class="pre">--forward-to</span> <span class="pre">https://localhost:5000/app/webhook</span> <span class="pre">--skip-verify</span></code></p>
<p>If you want to test subscription events used by this app, run the
following to make stripe CLI listen and forward the following events:</p>
<ul class="simple">
<li><p>customer.subscription.updated</p></li>
<li><p>customer.subscription.deleted</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">stripe</span> <span class="pre">listen</span> <span class="pre">-e</span> <span class="pre">customer.subscription.updated,customer.subscription.deleted,checkout.session.completed</span> <span class="pre">--forward-to</span> <span class="pre">https://localhost:5000/app/webhook/stripe</span> <span class="pre">--skip-verify</span></code></p>
<p>This returns the webhook signing secret we use to verify that Stripe
is the one sending webhook requests. This secret needs to be saved in
the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file as shown in <code class="docutils literal notranslate"><span class="pre">.env.template</span></code>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Some of the functionality will not work in your local development environment without having this listener forward the events from Stripe to the local instance of this app. For example, the account balance will not increment as this depends on the event from Stripe.</p>
</div>
</section>
</section>
<section id="database-model">
<h2>Database Model<a class="headerlink" href="#database-model" title="Link to this heading">ÔÉÅ</a></h2>
<p>We use Object Relational Mapping (ORM) with SQLAlchemy to interact with the
Postgres database. The database is created automatically when the app is
started. The tables are created based on the models defined in
<code class="docutils literal notranslate"><span class="pre">app/models.py</span></code>. In the dev environment, the database is created in a container
and it is accessible at <code class="docutils literal notranslate"><span class="pre">localhost:5432</span></code>. You can use pgAdmin to manage the
database. pgAdmin is already configured to connect to the Postgres container. When
prompted for the database password, use <code class="docutils literal notranslate"><span class="pre">password</span></code>.</p>
<p>A simple database model is defined in <code class="docutils literal notranslate"><span class="pre">app/models.py</span></code>. When the database tables
are created, a free tier is automatically added in the Tiers table.</p>
<pre  class="mermaid">
        erDiagram

    Users {
        int id PK
        string email
        string password
        string role
        string stripe_customer_id
        int tier_id FK
        bigint credits
        datetime cancel_at
        string firstName
        string lastName
        int newsletter
        datetime member_since
        datetime last_login
        string email_confirmation_code
        datetime last_confirmation_codes_sent
        int number_of_email_confirmation_codes_sent
        int email_confirmed
        string google_avatar_url
        boolean avatar_uploaded
        string totp_secret
        int totp_enabled
    }

    Tiers {
        int id PK
        string name
        string label
        string stripe_price_id
    }

    APIKeys {
        int id PK
        int user_id FK
        string key_hash
        string label
        datetime created_at
        datetime expires_at
        datetime last_used
        boolean is_active
    }

    BatchJobs {
        int id PK
        string uid
        int user_id FK
        string status
        string original_file_name
        string uploaded_file
        string accepted_file
        string results_file
        int row_count
        bigint last_pick_row
        datetime last_pick_time
        string source
        int header_row
        string email_column
        datetime uploaded
        datetime started
        datetime finished
        string result
    }

    Users }o--|| Tiers : &quot;has&quot;
    Users ||--o{ APIKeys : &quot;owns&quot;
    Users ||--o{ BatchJobs : &quot;creates&quot;
    </pre><section id="updating-the-database-model">
<h3>Updating the Database Model<a class="headerlink" href="#updating-the-database-model" title="Link to this heading">ÔÉÅ</a></h3>
<p>To ensure that the database schema is updated without losing existing data, we use database migrations with <code class="docutils literal notranslate"><span class="pre">Flask-Migrate</span></code>. This uses <code class="docutils literal notranslate"><span class="pre">Alembic</span></code> under the hood to manage database migrations. Here are the steps to update the database model:</p>
<ol class="arabic">
<li><p>Update the models in <code class="docutils literal notranslate"><span class="pre">app/models.py</span></code> as needed.</p></li>
<li><p>In the dev container terminal, run the following command to create a new migration script:</p>
<p><code class="docutils literal notranslate"><span class="pre">flask</span> <span class="pre">db</span> <span class="pre">migrate</span> <span class="pre">-m</span> <span class="pre">&quot;Description</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">change&quot;</span></code></p>
</li>
<li><p>Then run the following command to apply the migration to the local test database in your dev container:</p>
<p><code class="docutils literal notranslate"><span class="pre">flask</span> <span class="pre">db</span> <span class="pre">upgrade</span></code></p>
</li>
<li><p>Test the changes in the app.</p></li>
<li><p>Commit the changes, including the migration script in the <code class="docutils literal notranslate"><span class="pre">migrations/versions</span></code> directory.</p></li>
<li><p>When you push the changes to the remote repository, the CI/CD pipeline will automatically apply the migration to the production database.</p></li>
</ol>
<p>If you have already made changes to the database model before, I recommend not pulling the <code class="docutils literal notranslate"><span class="pre">/migrations</span></code> directory from this repository, and instead re-initialize the migrations with:</p>
<p><code class="docutils literal notranslate"><span class="pre">flask</span> <span class="pre">db</span> <span class="pre">init</span></code></p>
<p>Then follow the steps above to create a new migration script and upgrade the database.</p>
</section>
</section>
<section id="how-to-build-on-top-of-this-app">
<h2>How to Build On Top of This App<a class="headerlink" href="#how-to-build-on-top-of-this-app" title="Link to this heading">ÔÉÅ</a></h2>
<section id="adding-new-pages">
<h3>Adding New Pages<a class="headerlink" href="#adding-new-pages" title="Link to this heading">ÔÉÅ</a></h3>
<ol class="arabic simple">
<li><p>In both <code class="docutils literal notranslate"><span class="pre">public</span></code> and <code class="docutils literal notranslate"><span class="pre">private</span></code> directories, you can copy the
<code class="docutils literal notranslate"><span class="pre">sample-page.html</span></code> as a starter and rename it (e.g.¬†<code class="docutils literal notranslate"><span class="pre">test.html</span></code>).
The generic routing in <code class="docutils literal notranslate"><span class="pre">views.py</span></code> will automatically be served at
<code class="docutils literal notranslate"><span class="pre">/test</span></code> directory.</p></li>
<li><p>Update the page title at <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">set</span> <span class="pre">page_title</span> <span class="pre">=</span> <span class="pre">&quot;Sample</span> <span class="pre">Page&quot;</span> <span class="pre">%}</span></code>.</p></li>
<li><p>Insert a link to this page in <code class="docutils literal notranslate"><span class="pre">components/header/nav-menu.html</span></code>.
For the active page highlighting, we also need to update the path for
active link condition in this class:
<code class="docutils literal notranslate"><span class="pre">class=&quot;nav-link</span> <span class="pre">{%</span> <span class="pre">if</span> <span class="pre">path</span> <span class="pre">==</span> <span class="pre">'sample-page'</span> <span class="pre">%}active{%</span> <span class="pre">endif</span> <span class="pre">%}&quot;</span></code>.</p></li>
<li><p>Insert content between <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">content</span> <span class="pre">%}</span></code> and
<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">endblock</span> <span class="pre">content</span> <span class="pre">%}</span></code> as needed.</p></li>
</ol>
<p>Note that URLs with trailing slashes (e.g.¬†<code class="docutils literal notranslate"><span class="pre">/test/</span></code>) are redirected to
the alternatives without one (e.g.¬†<code class="docutils literal notranslate"><span class="pre">/test</span></code>).</p>
</section>
<section id="defining-more-configuration-variables">
<h3>Defining More Configuration Variables<a class="headerlink" href="#defining-more-configuration-variables" title="Link to this heading">ÔÉÅ</a></h3>
<p>If you need to have more config variables (e.g.¬†credentials for a new
OAuth provider):</p>
<ol class="arabic simple">
<li><p>Set environment variable in:</p>
<ul class="simple">
<li><p>your local <code class="docutils literal notranslate"><span class="pre">.env</span></code>  file in the dev environment,</p></li>
<li><p>in the <code class="docutils literal notranslate"><span class="pre">.env.template</span></code> file as a template for other developers and future use,</p></li>
<li><p>the production environment,</p></li>
<li><p>in <code class="docutils literal notranslate"><span class="pre">github/workflows/test.yml</span></code> for the testing pipeline,</p></li>
<li><p>in the secrets of the repository on GitHub.</p></li>
</ul>
</li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">app/config.py</span></code>, add a new attribute for the <code class="docutils literal notranslate"><span class="pre">Config</span></code> class.</p>
<ul class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">config</span></code> method from decouple to pull your environment variable.</p></li>
</ul>
</li>
<li><p>You can then call the config value anywhere in the app with
<code class="docutils literal notranslate"><span class="pre">app.config[&quot;YOUR_CONFIG_VARIABLE&quot;]</span></code>.</p></li>
</ol>
</section>
<section id="updating-dependencies">
<h3>Updating Dependencies<a class="headerlink" href="#updating-dependencies" title="Link to this heading">ÔÉÅ</a></h3>
<p>To include new Python packages, you can first install them in your local
virtual environment during development. Before pushing a change with a
new package, also update the dependencies using
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">freeze</span> <span class="pre">&gt;</span> <span class="pre">requirements.txt</span></code>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="features.html" class="btn btn-neutral float-left" title="Features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ci-cd.html" class="btn btn-neutral float-right" title="Continuous Integration and Continuous Deployment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Cansin Acarer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>